---
title: "Clue Search"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages, message=FALSE, warning=FALSE}
library(tidyverse)
library(readxl)
library(ggplot2)
library(ggthemes)
```

```{r data, message=FALSE, warning=FALSE}
clue_search <- read_csv("https://raw.githubusercontent.com/perfumer-58/clue_search/master/Data/clue_search_data.csv") %>%
  filter(complete.cases(.))

operators <- read_csv("https://raw.githubusercontent.com/perfumer-58/clue_search/master/Data/operators.csv")

dates <- clue_search %>%
  distinct(date)

operators_by_date <- dates %>%
  full_join(operators, by = c("date" = "from")) %>%
  complete(date, operator) %>%
  group_by(operator) %>%
  fill(rank, level, faction, bonus, .direction = "down") %>%
  filter(!is.na(operator))
  

clue_search <- clue_search %>%
  left_join(operators_by_date, by = c("date", "operator_1" = "operator")) %>%
  left_join(operators_by_date, by = c("date", "operator_2" = "operator"), suffix = c("_1", "_2"))

rm(dates, operators_by_date)
```


```{r summary, message=FALSE, warning=FALSE}
clue_search %>%
  group_by(operator_1, operator_2) %>%
  summarise(n = n()) %>%
  arrange(-n)
```

# Graphs
```{r plot, message=FALSE, warning=FALSE}
data <- clue_search %>%
  filter(bonus_1 == 0, bonus_2 == 0) %>%
  group_by(clue) %>%
  summarise(n = n()) %>% 
  mutate(prop = n / sum(n))

caption <- paste0("n = ",
                  sum(data$n),
                  "\nSource: vienne")

p <- data %>%
  ggplot(aes(x = clue, y = prop)) +
  geom_col() +
  labs(y = "", title = "Frequency of Clues",
       subtitle = "Operators without Clue Faction bonus",
       caption = caption) +
  scale_y_continuous(labels = scales::percent) +
  scale_x_continuous(breaks = 1:7) +
  theme_fivethirtyeight()
  
  
p
```

```{r export graphs, message=FALSE, warning=FALSE}
dir.create("Graphs")

ggsave("Graphs/frequency.png", plot = p, units = "in", width = 7, height = 432/700 * 7)
```
